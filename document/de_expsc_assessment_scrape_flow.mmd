flowchart TD
    A([Start]) --> B[Initialize DB Tables]
    B --> C{DB Initialized?}
    C -->|No| D[Exit Scraping]
    C -->|Yes| E[Read URLs from Excel]
    E --> F[Insert New URLs to DB with Status: PENDING & skip existing]
    F --> G[Find URLs with Status: PENDING]
    G --> H{URLs Found?}
    H -->|No| I[Generate Report & Exit]
    H -->|Yes| J[Loop Through URLs]
    J --> K[Update Repo Status: PROCESS]
    K --> L[Scrape Issues]
    
    subgraph "Issue Scraping"
        L --> M{Page Data in Temp?}
        M -->|Yes| N[Read from Temp]
        M -->|No| O[Call GitHub API]
        O --> P{Success?}
        P -->|No| Q["Retry? (max 3)"]
        Q -->|Attempt < 3| O
        Q -->|Max Attempts| R[Log Error]
        P -->|Yes| S[Save to Temp]
        S --> T[Export to CSV]
    end
    
    L --> U[Filter Issues with Comments]
    U --> V[Scrape Comments]
    
    subgraph "Comment Scraping"
        V --> W{Issue in DB Log?}
        W -->|Pending/Process/Failed| X[Call GitHub API]
        X --> Y{Success?}
        Y -->|No| Z["Retry? (max 3)"]
        Z -->|Attempt < 3| X
        Z -->|Max Attempts| AA[Log Error]
        Y -->|Yes| AB[Save to Temp]
        AB --> AC[Export to CSV]
    end
    
    V --> AD[Update Repo Status: COMPLETE]
    AD --> AE{More URLs?}
    AE -->|Yes| J
    AE -->|No| AF[Generate Final Report]
    AF --> AG([End])